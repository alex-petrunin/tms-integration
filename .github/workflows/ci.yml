name: CI

on:
  workflow_dispatch:
    inputs:
      triggerSource:
        description: "Source of trigger (YT issue ID, test repo, etc.)"
        required: false
      testCaseId:
        description: "Original Test Case ID"
        required: true
      testRunId:
        description: "Test Run ID (parent suite)"
        required: true
      individualTestRunId:
        description: "Individual Test Run ID (specific test case run)"
        required: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Run example
        run: echo "Hello from workflow"

      - name: Notify TMS App
        if: always()
        uses: ./.github/actions/notify-tms
        with:
          triggerSource: ${{ github.event.inputs.triggerSource }}
          testCaseId: ${{ github.event.inputs.testCaseId }}
          testRunId: ${{ github.event.inputs.testRunId }}
          individualTestRunId: ${{ github.event.inputs.individualTestRunId }}
          totalTests: 5
          passedTests: 3
          failedTests: 2
          failedTestsList: "Critical business logic test, Integration test - payment gateway"
          callbackUrl: ${{ secrets.WEBHOOK_URL }}
          youtrackToken: ${{ secrets.YOUTRACK_TOKEN }}
        env:
          CALLBACK_URL: ${{ secrets.WEBHOOK_URL }}
          YOUTRACK_TOKEN: ${{ secrets.YOUTRACK_TOKEN }}
